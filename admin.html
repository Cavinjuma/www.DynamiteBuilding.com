<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Upload an Image</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; max-width:640px; margin:2rem auto; padding:1rem; }
    .notice { background:#fffae0; border-left:4px solid #f0c000; padding:.8rem; margin-bottom:1rem; }
    label { display:block; margin-top:.8rem; }
    button { margin-top:1rem; padding:.6rem 1rem; }
    #result { margin-top:1rem; color:#064; }
    #error { margin-top:1rem; color:#a00; }
  </style>
</head>
<body>
  <h1>Upload an image</h1>

  <div class="notice">
    <strong>Privacy notice:</strong> By uploading, you consent to the image being emailed to the site owner (jumacavin28@gmail.com).
    This site will not email the file without your explicit consent (checked below). See our privacy policy for details.
  </div>

  <form id="uploadForm">
    <label>
      Choose an image (JPEG/PNG, max ~5MB):
      <input type="file" name="image" accept="image/jpeg,image/png" required>
    </label>

    <label>
      <input type="checkbox" name="consent" value="yes" required>
      I consent to this image being emailed to the site owner.
    </label>

    <label>
      Your email (optional - if you want a copy/receipt):
      <input type="email" name="userEmail" placeholder="you@example.com">
    </label>

    <button type="submit">Upload & Send</button>
  </form>

  <div id="result"></div>
  <div id="error"></div>

  <script>
    const form = document.getElementById('uploadForm');
    const result = document.getElementById('result');
    const errorEl = document.getElementById('error');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      result.textContent = '';
      errorEl.textContent = '';

      const fileInput = form.querySelector('input[type="file"]');
      if (!fileInput.files || fileInput.files.length === 0) {
        errorEl.textContent = 'Please choose a file.';
        return;
      }

      const file = fileInput.files[0];
      if (file.size > 6 * 1024 * 1024) { // small client guard
        errorEl.textContent = 'File appears too large (limit ~5MB).';
        return;
      }

      const fd = new FormData(form);
      result.textContent = 'Sending...';

      try {
        const res = await fetch('/api/upload', {
          method: 'POST',
          body: fd
        });

        const text = await res.text();
        if (!res.ok) {
          errorEl.textContent = text || 'Server error';
          result.textContent = '';
        } else {
          result.textContent = text;
        }
      } catch (err) {
        errorEl.textContent = 'Network error: ' + err.message;
        result.textContent = '';
      }
    });
  </script>
</body>
</html>
